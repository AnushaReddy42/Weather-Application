<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üå¶Ô∏è Weather Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-light: linear-gradient(135deg, #a1c4fd, #c2e9fb);
      --bg-dark: linear-gradient(135deg, #1e1e2f, #3a3a5a);
      --text-light: #333;
      --text-dark: #eee;
      --card-bg-light: rgba(255, 255, 255, 0.2);
      --card-bg-dark: rgba(0, 0, 0, 0.3);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Outfit', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      overflow: hidden;
      background: var(--bg-light);
      color: var(--text-light);
      transition: background 1s ease-in-out, color 0.5s ease;
    }

    body.dark-mode {
      background: var(--bg-dark);
      color: var(--text-dark);
    }

    .background-animated {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      overflow: hidden;
      z-index: -1;
      pointer-events: none;
    }

    .sun {
      position: absolute;
      top: 80px; left: 80%;
      width: 120px; height: 120px;
      background: radial-gradient(circle, #FFD700, #FFA500);
      border-radius: 50%;
      box-shadow: 0 0 50px #FFD700;
      animation: pulse 3s infinite ease-in-out;
    }

    .sun::before {
      content: '';
      position: absolute;
      width: 200px; height: 200px;
      top: -40px; left: -40px;
      background: radial-gradient(circle, rgba(255,215,0,0.3) 0%, transparent 70%);
      border-radius: 50%;
      animation: rotate 15s linear infinite;
    }

    .cloud {
      position: absolute;
      width: 100px;
      height: 60px;
      background: #fff;
      border-radius: 50%;
      box-shadow:
        30px 0 0 0 #fff,
        60px 0 0 0 #fff,
        15px -20px 0 0 #fff,
        45px -20px 0 0 #fff;
      opacity: 0.8;
      animation: cloudFloat linear infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    @keyframes rotate {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @keyframes cloudFloat {
      0% { transform: translateX(-200px); }
      100% { transform: translateX(120vw); }
    }

    .rain-drop {
      position: absolute;
      width: 2px; height: 15px;
      background: #00aaff;
      opacity: 0.6;
      animation: raindropFall 1.2s linear infinite;
    }

    @keyframes raindropFall {
      0% { top: -20px; }
      100% { top: 100%; }
    }

    .snowflake {
      position: absolute;
      color: white;
      font-size: 1.5rem;
      animation: fallSnow 10s linear infinite;
    }

    @keyframes fallSnow {
      0% {
        top: -10%;
        transform: translateX(0);
      }
      100% {
        top: 100%;
        transform: translateX(100px);
      }
    }

    .container {
      background: var(--card-bg-light);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      text-align: center;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
      transition: background 0.5s ease;
    }

    body.dark-mode .container {
      background: var(--card-bg-dark);
    }

    h1 {
      font-size: 2.2rem;
      margin-bottom: 20px;
    }

    .input-group {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 10px;
    }

    input {
      padding: 12px 16px;
      border-radius: 10px;
      border: none;
      font-size: 1rem;
      width: 250px;
      outline: none;
    }

    button {
      padding: 12px 20px;
      background-color: #0072ff;
      color: white;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    button:hover {
      background-color: #005bd4;
    }

    .weather-card {
      margin-top: 30px;
      animation: fadeIn 1s ease-in-out;
    }

    .weather-card img {
      width: 100px;
      animation: bounce 2s infinite;
    }

    .weather-card p {
      font-size: 1.2rem;
      margin-top: 10px;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Toggle Button Styling */
    .toggle-container {
      position: absolute;
      top: 20px;
      right: 20px;
    }

    .toggle-switch {
      position: relative;
      width: 60px;
      height: 30px;
      background-color: #bbb;
      border-radius: 30px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .toggle-switch::before {
      content: "üåû";
      position: absolute;
      top: 2px;
      left: 2px;
      width: 26px;
      height: 26px;
      border-radius: 50%;
      background: #fff;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.4s ease;
    }

    body.dark-mode .toggle-switch {
      background-color: #444;
    }

    body.dark-mode .toggle-switch::before {
      content: "üåô";
      left: 32px;
    }
  </style>
</head>
<body>
  <div class="toggle-container">
    <div class="toggle-switch" onclick="toggleTheme()"></div>
  </div>

  <div class="background-animated" id="backgroundEffect"></div>

  <div class="container">
    <h1>üå§Ô∏è Live Weather Dashboard</h1>
    <div class="input-group">
      <input type="text" id="cityInput" placeholder="Enter city name...">
      <button onclick="getWeather()">Get Weather</button>
    </div>
    <div class="weather-card" id="weatherCard" style="display:none">
      <img id="icon" alt="Weather icon">
      <h2 id="cityName"></h2>
      <p id="localTime"></p>
      <p id="temperature"></p>
      <p id="condition"></p>
      <p id="humidity"></p>
    </div>
  </div>

  <script>
    function toggleTheme() {
      document.body.classList.toggle("dark-mode");
    }

    function updateBackground(condition) {
      const bg = document.getElementById("backgroundEffect");
      bg.innerHTML = "";

      if (condition.includes("clear") || condition.includes("sun")) {
        const sun = document.createElement("div");
        sun.className = "sun";
        bg.appendChild(sun);
      }

      if (condition.includes("clouds")) {
        for (let i = 0; i < 8; i++) {
          const cloud = document.createElement("div");
          cloud.className = "cloud";
          cloud.style.top = `${Math.random() * 60 + 10}%`;
          cloud.style.left = `-${Math.random() * 200}px`;
          cloud.style.animationDuration = `${40 + Math.random() * 30}s`;
          cloud.style.opacity = `${0.6 + Math.random() * 0.4}`;
          cloud.style.transform = `scale(${0.7 + Math.random() * 0.6})`;
          bg.appendChild(cloud);
        }
      }

      if (condition.includes("rain")) {
        for (let i = 0; i < 60; i++) {
          const drop = document.createElement("div");
          drop.className = "rain-drop";
          drop.style.left = Math.random() * 100 + "vw";
          drop.style.animationDuration = 0.8 + Math.random() + "s";
          bg.appendChild(drop);
        }
      }

      if (condition.includes("snow") || condition.includes("cold")) {
        for (let i = 0; i < 30; i++) {
          const flake = document.createElement("div");
          flake.className = "snowflake";
          flake.textContent = "‚ùÑÔ∏è";
          flake.style.left = Math.random() * 100 + "vw";
          flake.style.fontSize = Math.random() * 10 + 10 + "px";
          flake.style.animationDuration = 5 + Math.random() * 5 + "s";
          flake.style.animationDelay = Math.random() * 5 + "s";
          bg.appendChild(flake);
        }
      }
    }

     async function getWeather() {
  const city = document.getElementById("cityInput").value.trim();
  if (!city) {
    alert("Please enter a city name.");
    return;
  }

  try {
    const response = await fetch(`http://localhost:1234/weather/${city}`);
    const data = await response.json();

    if (data.city === "N/A") {
      alert("City not found or API error.");
      return;
    }

    document.getElementById("cityName").textContent = `Weather in ${data.city}`;
    document.getElementById("temperature").textContent = `üå°Ô∏è Temperature: ${data.temperature} ¬∞C`;
    document.getElementById("condition").textContent = `üå§Ô∏è Condition: ${data.description}`;
    document.getElementById("humidity").textContent = `üíß Humidity: ${data.humidity}%`;

    // Display weather icon
    let condition = data.description.toLowerCase();
    let iconUrl = "https://openweathermap.org/img/wn/01d.png";
    if (condition.includes("clouds")) iconUrl = "https://openweathermap.org/img/wn/03d.png";
    else if (condition.includes("rain")) iconUrl = "https://openweathermap.org/img/wn/09d.png";
    else if (condition.includes("clear")) iconUrl = "https://openweathermap.org/img/wn/01d.png";
    else if (condition.includes("snow")) iconUrl = "https://openweathermap.org/img/wn/13d.png";

    document.getElementById("icon").src = iconUrl;
    document.getElementById("icon").alt = data.description;
    document.getElementById("weatherCard").style.display = "block";

    // üïí City Time Logic
    if (data.timeZone) {
      const timeResponse = await fetch(`https://timeapi.io/api/time/current/zone?timeZone=${encodeURIComponent(data.timeZone)}`);
      const timeData = await timeResponse.json();
      document.getElementById("localTime").textContent = `üïí Local Time: ${timeData.time}`;
    } else if (data.timezone !== undefined) {
      const timezoneOffset = data.timezone; // in seconds
      const nowUTC = new Date(new Date().getTime() + new Date().getTimezoneOffset() * 60000);
      const cityTime = new Date(nowUTC.getTime() + timezoneOffset * 1000);
      const formattedTime = cityTime.toLocaleTimeString();
      document.getElementById("localTime").textContent = `üïí Local Time: ${formattedTime}`;
    } else {
      document.getElementById("localTime").textContent = "üïí Time not available";
    }

    // Background animation
    updateBackground(condition);

  } catch (err) {
    console.error(err);
    alert("Failed to fetch weather data.");
  }
}

  </script>
</body>
</html>
